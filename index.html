<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ØªØªØ¨Ø¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© - Ù†Ø³Ø®Ø© Antigravity</title>
    <style>
        /* ØªØµÙ…ÙŠÙ… Ø¯Ø§Ø®Ù„ÙŠ Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø§Ù„Ø­Ø¸Ø± */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; padding: 20px; direction: rtl; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 1100px; margin: auto; }
        input { width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #eee; padding: 12px; text-align: center; }
        th { background-color: #007bff; color: white; position: sticky; top: 0; }
        tr:nth-child(even) { background-color: #f8f9fa; }
        .error-box { color: #721c24; background: #f8d7da; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: none; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸš€ Ù„ÙˆØ­Ø© ØªØªØ¨Ø¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø°ÙƒÙŠØ©</h2>
    <div id="error" class="error-box"></div>
    <input type="text" id="search" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£ÙŠ Ø¬Ù‡Ø§Ø² Ø£Ùˆ Ø­Ø§Ù„Ø©...">
    <div id="loading">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨...</div>
    <div style="overflow-x: auto; max-height: 600px;">
        <table id="dataTable">
            <thead id="head"></thead>
            <tbody id="body"></tbody>
        </table>
    </div>
</div>

<script>
    async function init() {
        const errorDiv = document.getElementById('error');
        try {
            // Ø¬Ù„Ø¨ Ù…Ù„Ù Ø§Ù„Ù€ JSON Ø§Ù„Ù†Ø¸ÙŠÙ
            const res = await fetch('device_traceability.json');
            if (!res.ok) throw new Error("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„Ù. ØªØ£ÙƒØ¯ Ù…Ù† Ø±ÙØ¹Ù‡ Ø¨Ø§Ø³Ù… device_traceability.json");
            
            const data = await res.json();
            const items = data.Sheet1 || []; // Ø¹Ø±Ø¶ Sheet1 Ø£ÙˆÙ„Ø§Ù‹

            document.getElementById('loading').style.display = 'none';
            render(items);

            // Ù…ÙŠØ²Ø© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù„Ø­Ø¸ÙŠ
            document.getElementById('search').addEventListener('input', (e) => {
                const term = e.target.value.toLowerCase();
                const filtered = items.filter(row => 
                    Object.values(row).some(v => String(v).toLowerCase().includes(term))
                );
                render(filtered);
            });

        } catch (err) {
            errorDiv.style.display = 'block';
            errorDiv.innerText = "âŒ Ø®Ø·Ø£: " + err.message;
            document.getElementById('loading').style.display = 'none';
        }
    }

    function render(list) {
        const head = document.getElementById('head');
        const body = document.getElementById('body');
        
        if (list.length === 0) {
            body.innerHTML = "<tr><td colspan='100%'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©</td></tr>";
            return;
        }

        const keys = Object.keys(list[0]);
        head.innerHTML = `<tr>${keys.map(k => `<th>${k}</th>`).join('')}</tr>`;
        
        body.innerHTML = list.map(row => `
            <tr>${keys.map(k => `<td>${row[k] !== null ? row[k] : ''}</td>`).join('')}</tr>
        `).join('');
    }

    init();
</script>
</body>
</html>
